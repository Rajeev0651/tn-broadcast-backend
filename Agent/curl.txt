# ============================================================================
# Codeforces Contest API - cURL Requests for Postman
# ============================================================================
# Base URL: http://localhost:4000/api/codeforces
# Replace localhost:4000 with your server address
# 
# IMPORTANT: For Postman, use the collection file instead:
# → Import: Agent/Codeforces_API.postman_collection.json
# 
# This file contains all REST API endpoints organized by:
# - GraphQL APIs: Fetch directly from Codeforces API
# - WRITE APIs: Fetch from Codeforces API and store in MongoDB
# - READ APIs: Read data from MongoDB only
#
# When adding new API endpoints:
# 1. Add GraphQL requests in the "GRAPHQL API ENDPOINTS" section
# 2. Add WRITE APIs in the "WRITE APIs" section below
# 3. Add READ APIs in the "READ APIs" section below
# 4. Update the corresponding route in src/routes/codeforcesRoutes.js
# 5. Update Codeforces_API.postman_collection.json (import into Postman to sync)
# 6. Update ARCHITECTURE.md if needed
# ============================================================================

# ============================================================================
# GRAPHQL API ENDPOINTS
# ============================================================================
# GraphQL Base URL: http://localhost:4000/graphql
# These endpoints fetch directly from Codeforces API (not from DB)
# ============================================================================

# ============================================
# 1. Get Contest List (without gym contests)
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestList(includeGym: false) { id name type phase frozen durationSeconds startTimeSeconds } }"
  }'

# ============================================
# 2. Get Contest List (with gym contests)
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestList(includeGym: true) { id name type phase frozen durationSeconds startTimeSeconds } }"
  }'

# ============================================
# 3. Get Contest Standings (default - official participants only)
# Note: showUnofficial defaults to false, so you can omit it
# ============================================
# Without showUnofficial parameter (defaults to false):
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestStandings(contestId: 566) { contest { id name type phase } problems { index name points tags } rows { rank points penalty successfulHackCount unsuccessfulHackCount party { members { handle } participantType } } } } }"
  }'

# Explicitly set showUnofficial: false (same as default):
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestStandings(contestId: 566, showUnofficial: false) { contest { id name type phase } problems { index name points tags } rows { rank points penalty successfulHackCount unsuccessfulHackCount party { members { handle } participantType } } } } }"
  }'

# ============================================
# 4. Get Contest Standings (including unofficial participants)
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestStandings(contestId: 566, showUnofficial: true) { contest { id name type phase } problems { index name points tags } rows { rank points penalty successfulHackCount unsuccessfulHackCount party { members { handle } participantType } } } } }"
  }'

# ============================================
# 5. Get All Submissions for a Contest
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestSubmissions(contestId: 566) { id contestId creationTimeSeconds problem { index name points } author { members { handle } } programmingLanguage verdict passedTestCount timeConsumedMillis memoryConsumedBytes } }"
  }'

# ============================================
# 6. Get Submissions for a Specific User in a Contest
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestSubmissions(contestId: 566, handle: \"tourist\") { id contestId creationTimeSeconds problem { index name points } author { members { handle } } programmingLanguage verdict passedTestCount timeConsumedMillis memoryConsumedBytes } }"
  }'

# ============================================
# 7. Get Rating Changes for a Contest
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestRatingChanges(contestId: 566) { contestId contestName handle rank ratingUpdateTimeSeconds oldRating newRating } }"
  }'

# ============================================
# 8. Get Hacks for a Contest
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getContestHacks(contestId: 566) { id creationTimeSeconds hacker { members { handle } } defender { members { handle } } verdict problem { index name } } }"
  }'

# ============================================
# 9. Get Complete Contest Data (default - official participants only)
# Note: showUnofficial defaults to false, so you can omit it
# ============================================
# Without showUnofficial parameter (defaults to false):
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getCompleteContestData(contestId: 566) { contest { id name type phase } problems { index name points tags } standings { rank points penalty party { members { handle } } } submissions { id verdict problem { index } author { members { handle } } } ratingChanges { handle rank oldRating newRating } hacks { id verdict hacker { members { handle } } defender { members { handle } } } } }"
  }'

# Explicitly set showUnofficial: false (same as default):
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getCompleteContestData(contestId: 566, showUnofficial: false) { contest { id name type phase } problems { index name points tags } standings { rank points penalty party { members { handle } } } submissions { id verdict problem { index } author { members { handle } } } ratingChanges { handle rank oldRating newRating } hacks { id verdict hacker { members { handle } } defender { members { handle } } } } }"
  }'

# ============================================
# 10. Get Complete Contest Data (with unofficial participants)
# ============================================
curl -X POST http://localhost:4000/graphql \
  -H "Content-Type: application/json" \
  -d '{
    "query": "query { getCompleteContestData(contestId: 566, showUnofficial: true) { contest { id name type phase } problems { index name points tags } standings { rank points penalty party { members { handle } } } submissions { id verdict problem { index } author { members { handle } } } ratingChanges { handle rank oldRating newRating } hacks { id verdict hacker { members { handle } } defender { members { handle } } } } }"
  }'

# ============================================================================
# REST API ENDPOINTS - WRITE APIs
# ============================================================================
# These APIs fetch data from Codeforces API and store it in MongoDB.
# They use batched storage (1000 records per document) for optimal performance.
# 
# When adding new WRITE APIs:
# 1. Add your curl request in this section
# 2. Add corresponding route handler in src/routes/codeforcesRoutes.js (WRITE APIs section)
# 3. Add service method in src/services/codeforcesDataService.js if needed
# 4. Update ARCHITECTURE.md if needed
# ============================================================================

# ============================================
# 11. Store Complete Contest Data
# Fetches from Codeforces API and stores in MongoDB
# Standings → BatchedStandingsData collection (separate)
# Submissions, RatingChanges, Hacks → BatchedContestData collection
# ============================================
# Store contest data (default - official participants only)
# Note: showUnofficial defaults to false, so you can omit it
curl -X POST "http://localhost:4000/api/codeforces/contests/2182/store" \
  -H "Content-Type: application/json"

# Explicitly set showUnofficial=false (same as default):
curl -X POST "http://localhost:4000/api/codeforces/contests/2182/store?showUnofficial=false" \
  -H "Content-Type: application/json"

# Store contest data with unofficial participants
curl -X POST "http://localhost:4000/api/codeforces/contests/2182/store?showUnofficial=true" \
  -H "Content-Type: application/json"

# Using POST body (alternative):
curl -X POST "http://localhost:4000/api/codeforces/contests/566/store" \
  -H "Content-Type: application/json" \
  -d '{
    "showUnofficial": false
  }'

# Performance Notes:
# - Uses bulk write operations (6-10x faster)
# - Stores data in batches of 1000 records per document
# - Standings stored in separate BatchedStandingsData collection
# - Submissions, ratingChanges, hacks stored in BatchedContestData collection
# - Automatically detects new vs existing data
# - Returns performance metrics (fetch time, prepare time, store time)

# ============================================
# 12. Store Contest List
# Fetches all contests from Codeforces API and stores in MongoDB
# ============================================
# Store contest list (without gym contests)
curl -X POST "http://localhost:4000/api/codeforces/contests/store-list?includeGym=false" \
  -H "Content-Type: application/json"

# Store contest list (with gym contests)
curl -X POST "http://localhost:4000/api/codeforces/contests/store-list?includeGym=true" \
  -H "Content-Type: application/json"

# Using POST body (alternative):
curl -X POST "http://localhost:4000/api/codeforces/contests/store-list" \
  -H "Content-Type: application/json" \
  -d '{
    "includeGym": false
  }'

# ============================================================================
# REST API ENDPOINTS - READ APIs
# ============================================================================
# These APIs only read data from MongoDB. They do NOT fetch from Codeforces API.
# Use these APIs when you need to retrieve data that has already been stored.
# 
# When adding new READ APIs:
# 1. Add your curl request in this section
# 2. Add corresponding route handler in src/routes/codeforcesRoutes.js (READ APIs section)
# 3. Use models directly or dataService query methods
# 4. Add pagination if returning large datasets
# 5. Update ARCHITECTURE.md if needed
# ============================================================================

# ============================================
# 13. Get Contest Data from Database
# Returns contest metadata, problems, and counts
# ============================================
curl -X GET "http://localhost:4000/api/codeforces/contests/566" \
  -H "Content-Type: application/json"

# ============================================
# 14. Get Contest Standings from Database
# Returns standings data with pagination support
# Reads from BatchedStandingsData collection
# Note: unofficial defaults to false (official participants only)
# ============================================
# Get first 100 standings (default - official participants only)
# Note: unofficial parameter defaults to false, so you can omit it
curl -X GET "http://localhost:4000/api/codeforces/contests/566/standings" \
  -H "Content-Type: application/json"

# Get standings with pagination
curl -X GET "http://localhost:4000/api/codeforces/contests/566/standings?limit=50&skip=0" \
  -H "Content-Type: application/json"

# Get unofficial standings only
curl -X GET "http://localhost:4000/api/codeforces/contests/566/standings?unofficial=true&limit=100" \
  -H "Content-Type: application/json"

# ============================================
# 15. Get Contest Submissions from Database
# Returns submissions data with pagination and filtering
# Reads from BatchedContestData collection
# ============================================
# Get first 100 submissions (default)
curl -X GET "http://localhost:4000/api/codeforces/contests/566/submissions" \
  -H "Content-Type: application/json"

# Get submissions with pagination
curl -X GET "http://localhost:4000/api/codeforces/contests/566/submissions?limit=50&skip=0" \
  -H "Content-Type: application/json"

# Get submissions for a specific user
curl -X GET "http://localhost:4000/api/codeforces/contests/566/submissions?handle=tourist&limit=100" \
  -H "Content-Type: application/json"

# ============================================================================
# OTT STREAMING PLATFORM API ENDPOINTS
# ============================================================================
# Base URL: http://localhost:4000/api
# Replace localhost:4000 with your server address
# 
# These APIs manage Media and Stream entities for OTT streaming platform.
# Media can be pre-recorded (HLS) or external streams.
# Streams are assigned to Contest events.
# ============================================================================

# ============================================================================
# MEDIA API ENDPOINTS
# ============================================================================
# Base URL: http://localhost:4000/api/media
# ============================================================================

# ============================================
# 16. Create Media (Pre-recorded)
# ============================================
curl -X POST "http://localhost:4000/api/media" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "pre-recorded",
    "url": "https://example.com/videos/master.m3u8",
    "name": "Sample Video",
    "description": "A sample pre-recorded video",
    "duration": 3600,
    "metadata": {
      "resolution": "1080p",
      "codec": "h264"
    }
  }'

# ============================================
# 17. Create Media (External Stream)
# ============================================
curl -X POST "http://localhost:4000/api/media" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "external",
    "url": "rtmp://example.com/live/stream",
    "name": "Live Stream",
    "description": "External live stream URL",
    "metadata": {
      "source": "external_cdn"
    }
  }'

# ============================================
# 18. List All Media (with pagination)
# ============================================
# Get first 100 media (default)
curl -X GET "http://localhost:4000/api/media" \
  -H "Content-Type: application/json"

# Get media with pagination
curl -X GET "http://localhost:4000/api/media?limit=50&skip=0" \
  -H "Content-Type: application/json"

# Filter by type (pre-recorded)
curl -X GET "http://localhost:4000/api/media?type=pre-recorded&limit=100" \
  -H "Content-Type: application/json"

# Filter by type (external)
curl -X GET "http://localhost:4000/api/media?type=external&limit=100" \
  -H "Content-Type: application/json"

# ============================================
# 19. Get Media by uniqueId
# ============================================
curl -X GET "http://localhost:4000/api/media/1" \
  -H "Content-Type: application/json"

# ============================================
# 20. Get Media by hashcode
# ============================================
curl -X GET "http://localhost:4000/api/media/hashcode/abcd-1234-efgh-5678" \
  -H "Content-Type: application/json"

# ============================================
# 21. Update Media
# ============================================
curl -X PUT "http://localhost:4000/api/media/1" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Updated Video Name",
    "description": "Updated description",
    "duration": 7200
  }'

# ============================================
# 22. Delete Media
# ============================================
# Note: Will fail if media is used by any streams
curl -X DELETE "http://localhost:4000/api/media/1" \
  -H "Content-Type: application/json"

# ============================================================================
# STREAM API ENDPOINTS
# ============================================================================
# Base URL: http://localhost:4000/api/streams
# ============================================================================

# ============================================
# 23. Create Stream
# ============================================
# Note: mediaId can be Media uniqueId (integer) or ObjectId
#       contestId must exist in Contests collection
curl -X POST "http://localhost:4000/api/streams" \
  -H "Content-Type: application/json" \
  -d '{
    "mediaId": 1,
    "contestId": 566,
    "title": "Contest Live Stream",
    "description": "Live streaming of contest",
    "status": "scheduled",
    "startTime": "2024-01-15T10:00:00Z",
    "endTime": "2024-01-15T14:00:00Z",
    "thumbnail": "https://example.com/thumbnails/stream.jpg",
    "metadata": {
      "quality": "1080p",
      "language": "en"
    }
  }'

# ============================================
# 24. List All Streams (with pagination and filters)
# ============================================
# Get first 100 streams (default)
curl -X GET "http://localhost:4000/api/streams" \
  -H "Content-Type: application/json"

# Get streams with pagination
curl -X GET "http://localhost:4000/api/streams?limit=50&skip=0" \
  -H "Content-Type: application/json"

# Filter by contestId
curl -X GET "http://localhost:4000/api/streams?contestId=566&limit=100" \
  -H "Content-Type: application/json"

# Filter by status
curl -X GET "http://localhost:4000/api/streams?status=live&limit=100" \
  -H "Content-Type: application/json"

# Filter by mediaId
curl -X GET "http://localhost:4000/api/streams?mediaId=1&limit=100" \
  -H "Content-Type: application/json"

# Combined filters
curl -X GET "http://localhost:4000/api/streams?contestId=566&status=live&limit=50&skip=0" \
  -H "Content-Type: application/json"

# ============================================
# 25. Get Stream by uniqueId
# ============================================
curl -X GET "http://localhost:4000/api/streams/1" \
  -H "Content-Type: application/json"

# ============================================
# 26. Get Streams for a Contest
# ============================================
curl -X GET "http://localhost:4000/api/streams/contest/566" \
  -H "Content-Type: application/json"

# ============================================
# 27. Update Stream
# ============================================
# Note: Status transitions are validated
# Valid: scheduled→live/cancelled, live→finished/cancelled
curl -X PUT "http://localhost:4000/api/streams/1" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Updated Stream Title",
    "status": "live",
    "viewerCount": 1500,
    "description": "Updated description"
  }'

# ============================================
# 28. Delete Stream
# ============================================
curl -X DELETE "http://localhost:4000/api/streams/1" \
  -H "Content-Type: application/json"

# ============================================================================
# GENERAL NOTES
# ============================================================================
# - Replace contestId: 566 with the actual contest ID you want to query
# - Replace "tourist" with the actual handle you want to query
# - GraphQL APIs fetch directly from Codeforces API (not from DB)
# - REST WRITE APIs fetch from Codeforces API and store in MongoDB
# - REST READ APIs retrieve data from MongoDB (must be stored first using WRITE APIs)
# - Rate limiting is handled automatically (2 seconds between requests)
# - Responses are cached to reduce API calls
# - Batched storage: 1000 records per document for optimal performance
# 
# OTT Streaming Platform Notes:
# - Media uniqueId (integer) and hashcode are auto-generated on creation
# - Media uniqueId: Auto-incremented integer starting from 1
# - Media hashcode format: xxxx-xxxx-xxxx-xxxx (hexadecimal)
# - Stream uniqueId (integer) is auto-generated on creation
# - Stream uniqueId: Auto-incremented integer starting from 1
# - Media can be reused by multiple streams (one-to-many relationship)
# - Stream status transitions: scheduled→live/cancelled, live→finished/cancelled
# - Media deletion is prevented if used by any streams
# - All stream responses include populated media data
# ============================================================================
